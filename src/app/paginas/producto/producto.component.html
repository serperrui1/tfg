<!-- <app-navbar [cuant]=(cantidades)></app-navbar> -->
<div class="wrapper" style="margin: auto; padding-top: 20px;" *ngIf="producto">

    <div class="row">

        <div class="col-md-1"></div>

        <div class="col-md-3 producto-izquierda">
            <div style="height: 250px;">
                <img src="{{direccionImagen + imagenMostrar}}" class="imagen">
            </div>
            <div class="row">
                <div *ngFor="let imagen of producto.imagenes" class="col-md-2 imagenes-container">
                    <img src="{{direccionImagen + imagen}}" class="imagen-miniatura" (mouseover)="imagenMostrar=imagen">
                </div>
            </div>
        </div>


        <div class="col-md-5 producto-derecha">
            <h3 style="text-align: left;">{{producto.titulo}}</h3>
            Tienda de:
            <a routerLink="/escaparate/{{proveedorId}}" class="link">{{producto.proveedorNombre}} </a> <br> Categoría del producto: <a>{{producto.categoria}} </a> <br> Subcategoría: <a>{{producto.subcategoria}} </a> <br>
            <div>
                <p class="precio-unidades">Precio por unidad: {{producto.precio}}€ </p>
                <p class="precio-unidades">Unidades mínimas: {{producto.unidadesMinimas}}</p>
                <br>
            </div>
            <p style="white-space: pre-wrap">
                {{producto.descripcion}}
            </p>
            <br>
            <div class="detalles-tecnicos" *ngIf="producto.datosTecnicos[0]">
                <h4 class="titulo-detalles text-left">Detalles técnicos</h4>
                <table class="table table-bordered titulo-detalles">
                    <tbody>
                        <tr *ngFor="let datos of producto.datosTecnicos">
                            <td>{{datos.datosTecnicosTitulo}}</td>
                            <td>{{datos.datosTecnicosDescripcion}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <div class="col-md-2 infoFinal " *ngIf="!soyElProveedor">
            <div class="contenido-infoFinal">
                <div *ngIf="!(producto.unidadesMinimas >= producto.stock); else noStock">
                    <strong style="color:red">{{producto.precio * cantidadProducto}}€</strong> con {{cantidadProducto}} unidades
                    <div>
                        <strong style="color: green;">En stock</strong>
                        <form [formGroup]="productoForm">
                            <label for="cantidad"><a>Cantidad : </a></label>
                            <input type="number" min="{{producto.unidadesMinimas}}" max="{{producto.stock}}" step="1" id="cantidad" formControlName="cantidadProducto">
                        </form>
                    </div>
                    <a class="btn btn-lg btn-primary btn-sm btn-block decompra" (click)="alCarrito(producto)">
                    Añadir al carrito
                </a>
                    <a class="btn btn-lg btn-primary btn-sm btn-block decompra" (click)="comprar(producto)">
                    Comprar
                </a>
                </div>
                <ng-template #noStock>
                    <strong style="color: red; ">No hay stock</strong>
                    <br><br>
                </ng-template>
                <a *ngIf="!existeChat && comp" class="btn btn-lg btn-primary btn-sm btn-block decompra" routerLink="/crear-chat/{{producto._id}}">
                    Contacta con el proveedor
                </a>
                <a *ngIf="existeChat && comp" class="btn btn-lg btn-primary btn-sm btn-block decompra" routerLink="/chat/{{existeChat}}">
                    Contacta con el proveedor
                </a>
                <a *ngIf="!comp" class="btn btn-lg btn-primary btn-sm btn-block decompra" (click)="logeate()">
                    Contacta con el proveedor
                </a>
                <div class="garantia">
                    <a routerLink="/garantia" class="m-l-5 link"> Ver la garantía de los productos</a>
                </div>

                <br>
                <a *ngIf="flag" class="btn btn-lg btn-primary btn-sm btn-block decompra" routerLink="/devolver-reclamar/{{pedidoId}}">
                    Solicitar devolución/reclamación
                </a>
            </div>
        </div>
        <div class="col-md-2" *ngIf="soyElProveedor">

            <div class="soyProveedor">
                <h6 class="text-center aviso">Eres el proveedor de este producto</h6>
                <hr>
                <a class="btn btn-lg btn-primary btn-sm btn-block" (click)="goEditIfProveedor()">Actualizar producto</a>
            </div>
        </div>

        <div class="col-md-1"></div>

    </div>

    <br>
    <br>

    <div class="row">

        <div class="col-md-1"></div>


        <div class="col-md-5 titulo-valorar" *ngIf="flag || yaValorado">
            <h4 *ngIf="yaValorado"> Todas las valoraciones </h4>
            <h4 *ngIf="!yaValorado && producto.valoraciones.length>0"> Valoraciones </h4>
            <div class="alert" *ngFor="let item of producto.valoraciones; let i = index">
                <ngb-rating [max]="5" [(rate)]="item.puntuacion" [readonly]="true"></ngb-rating>
                <p>Publicado por: {{this.nombres[i]}}</p>
                <p> {{item.comentario}}</p>
            </div>
        </div>

        <div class="col-md-10 titulo-valorar" *ngIf="!flag && !yaValorado">
            <h4 *ngIf="yaValorado"> Todas las valoraciones </h4>
            <h4 *ngIf="!yaValorado && producto.valoraciones.length>0"> Valoraciones </h4>
            <div class="alert" *ngFor="let item of producto.valoraciones; let i = index">
                <ngb-rating [max]="5" [(rate)]="item.puntuacion" [readonly]="true"></ngb-rating>
                <p>Publicado por: {{this.nombres[i]}}</p>
                <p> {{item.comentario}}</p>
            </div>
        </div>


        <div class="col-md-5" *ngIf="flag && !yaValorado">
            <h5>Valorar el producto</h5>
            <form class="form p-t-20" autocomplete="off" [formGroup]="valoracionForm">
                <div class="form-group">
                    <div class="input-group">
                        <ngb-rating [max]="5" [(rate)]="starRating" [resettable]="true" [readonly]="false" (hover)="isRating = true; hovered = $event" (leave)="isRating = false; hovered = 0" (rateChange)="getRating($event)"></ngb-rating>
                    </div>
                </div>
                <div class="form-group">
                    <label for="comentario">Comentario</label>
                    <div class="input-group">
                        <div class="input-group-addon"><i class="ti-user"></i></div>
                        <textarea type="text" class="form-control" id="comentario" formControlName="comentario"></textarea>
                    </div>
                </div>
            </form>
            <button type="submit" class="btn btn-success btn-block waves-effect waves-light m-r-10" [disabled]="valoracionForm.invalid" (click)="publicarValoracion()">
            <i class="fa fa-save"></i>
            Publicar valoración
        </button>
        </div>


        <div class="col-md-5 titulo-valorar" *ngIf="yaValorado">
            <h4> Mi valoración </h4>
            <div class="alert">
                <ngb-rating [max]="5" [(rate)]="miValoracion.puntuacion" [readonly]="true"></ngb-rating>
                <p>Comentario:
                    <br> "{{miValoracion.comentario}}"
                </p>
                <td class="text-nowrap text-center">
                    <a class="cursor" data-toggle="tooltip" data-original-title="Borrar" (click)="borrarValoracion()">
                        <i class="fa fa-trash-o" style="font-size:24px;color:red"></i>
                    </a>
                </td>
            </div>
        </div>

        <div class="col-md-1"></div>

    </div>


</div>